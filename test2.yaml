#!/usr/bin/python
# coding=utf-8
#

import velocloud;
from velocloud.rest import ApiException
import urllib3

urllib3.disable_warnings()
velocloud.configuration.verify_ssl = False
client = velocloud.ApiClient(host="172.18.6.250")
api = velocloud.AllApi(client) 

try:
  client.authenticate("super@velocloud.net", "vcadm!n", operator=True)

except ApiException as e: 
  print e

edge_stack = api.edgeGetEdgeConfigurationStack({ "enterpriseId": 1, "edgeId": 4, "with": ["modules"] })

configuration = api.configurationGetConfiguration({ "enterpriseId": 1, "configurationId": edge_stack[0].id, "with": ["modules"] })

device_module = None
for module in configuration.modules:
  if module.name == "deviceSettings":
    device_module = module
    break

#response = api.configurationGetConfiguration({"id": 70, "enterpriseId": 1 })
print (device_module.data['lan']['networks'][0]['cidrIp'])
print (device_module.id)
print (device_module.data['routedInterfaces'][1]['wanOverlay'])

device_module.data['lan']['networks'][0]['cidrIp'] = '10.0.6.1'
device_module.data['routedInterfaces'][1]['wanOverlay'] = 'USER_DEFINED'

# Update Device settings
response = api.configurationUpdateConfigurationModule({"id": device_module.id, "enterpriseId": 1, "_update": device_module })
print (response)

wan_module = None
for module in configuration.modules:
  if module.name == "WAN":
    wan_module = module
    break

    #print (configuration.modules)
    #print (wan_module.data['links'][1]['interfaces'])

    #wan_module.data['links'][1]['interfaces'][0]= 'GE4'
    #print (wan_module.data['links'][1]['interfaces'])

update = {
         "data": {
            "links": [
               {
                  "discovery": "AUTO_DISCOVERED",
                  "mode": "PUBLIC",
                  "type": "WIRED",
                  "name": "internet",
                  "publicIpAddress": "20.20.50.100",
                  "vlanId": 0,
                  "bwMeasurement": "SLOW_START",
                  "MTU": 1500,
                  "mplsNetwork": "",
                  "interfaces": [
                     "GE3"
                  ]
               },
               {
                  "discovery": "USER_DEFINED",
                  "mode": "PRIVATE",
                  "type": "WIRED",
                  "name": "mpls",
                  "vlanId": 0,
                  "bwMeasurement": "SLOW_START",
                  "overheadBytes": 0,
                  "MTU": 1500,
                  "interfaces": [
                     "GE4"
                  ]
               }
            ]
         }
      }

# Update WAN settings
response = api.configurationUpdateConfigurationModule({"id": wan_module.id, "enterpriseId": 1, "_update": update })
print (response)
